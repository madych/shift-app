<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚·ãƒ•ãƒˆè¡¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family: sans-serif; padding: 10px; }
h2 { margin-bottom: 5px; }

.controls { margin-bottom: 10px; }
button { margin: 3px; padding: 6px 10px; }

table {
  border-collapse: collapse;
  width: 100%;
}
th, td {
  border: 1px solid #999;
  padding: 6px;
  text-align: center;
}
th { background: #f0f0f0; }

.name-input {
  border: none;
  width: 95%;
  text-align: center;
  font-size: 14px;
}

.shift-cell {
  min-height: 28px;
  cursor: pointer;
  user-select: none;
}
</style>
</head>

<body>

<h2>ã‚·ãƒ•ãƒˆè¡¨ï¼ˆæœˆæ›œã¯ã˜ã¾ã‚Šãƒ»æœˆã€œåœŸï¼‰</h2>

<div class="controls">
  <button onclick="prevWeek()">â—€ å‰é€±</button>
  <strong id="weekLabel"></strong>
  <button onclick="nextWeek()">æ¬¡é€± â–¶</button>
</div>

<div class="controls">
  <button onclick="addStaff()">ï¼‹ã‚¹ã‚¿ãƒƒãƒ•è¿½åŠ </button>
  <button onclick="makeImage()">ğŸ“¸ ç”»åƒâ†’LINE</button>
</div>

<table id="shiftTable">
  <tr>
    <th>åå‰</th>
    <th>æœˆ</th><th>ç«</th><th>æ°´</th><th>æœ¨</th><th>é‡‘</th><th>åœŸ</th>
  </tr>
</table>

<!-- html2canvas -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
/* ===== é€±ç®¡ç† ===== */
let currentMonday = getMonday(new Date());

function getMonday(d) {
  const date = new Date(d);
  const day = date.getDay();
  const diff = (day === 0 ? -6 : 1) - day;
  date.setDate(date.getDate() + diff);
  return date;
}

function updateWeekLabel() {
  const m = currentMonday.getMonth() + 1;
  const d = currentMonday.getDate();
  document.getElementById("weekLabel").textContent = `${m}/${d} é€±`;
}

function prevWeek() {
  currentMonday.setDate(currentMonday.getDate() - 7);
  updateWeekLabel();
}

function nextWeek() {
  currentMonday.setDate(currentMonday.getDate() + 7);
  updateWeekLabel();
}

/* ===== è¡¨æ“ä½œ ===== */
function addStaff(name = "æ–°è¦") {
  const table = document.getElementById("shiftTable");
  const row = table.insertRow();

  row.innerHTML = `
    <td><input class="name-input" value="${name}"></td>
    ${"<td class='shift-cell'></td>".repeat(6)}
  `;

  row.querySelectorAll(".shift-cell").forEach(cell => {
    cell.addEventListener("click", () => editCell(cell));
  });
}

function editCell(cell) {
  const values = ["", "ã€‡", "9:00ã€œ", "17:00ã€œ", "19:00ã€œ"];
  const current = cell.textContent.trim();
  const index = values.indexOf(current);
  cell.textContent = values[(index + 1) % values.length];
}

/* ===== ç”»åƒ â†’ LINE ===== */
function makeImage() {
  html2canvas(document.getElementById("shiftTable")).then(canvas => {
    canvas.toBlob(blob => {
      const file = new File([blob], "shift.png", { type: "image/png" });
      if (navigator.share) {
        navigator.share({ files: [file] });
      } else {
        const url = URL.createObjectURL(blob);
        window.open(url);
        alert("ç”»åƒã‚’é•·æŠ¼ã— â†’ å…±æœ‰ â†’ LINE");
      }
    });
  });
}

/* ===== åˆæœŸåŒ– ===== */
updateWeekLabel();
addStaff("ç”°ä¸­");
addStaff("ä½è—¤");
</script>

</body>
</html>
